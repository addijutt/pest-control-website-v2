<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pest Controls - #1 Rated Pest Exterminator</title>
  <meta name="description" content="Pest problem? Pest Controls can link you with a local pest expert. They can inspect, remove, and prevent them from returning today!">

  <!-- Preload critical resources -->
  <link rel="preconnect" href="https://cdnjs.cloudflare.com">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="preconnect" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" as="style" crossorigin>


  <!-- Inline critical CSS -->


  <!-- Non-critical CSS -->
  <link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap">

  <!-- Favicon -->
  <link rel="icon" href="/images/favicon.png" type="image/x-icon">
  <!-- Font Awesome with fallback -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
        integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw=="
        crossorigin="anonymous"
        referrerpolicy="no-referrer"
        media="print"
        onload="this.media='all'">
</head>
<body class="home">
<div id="root"></div>

 <!-- time spent on site tracking script ( important, do not remove - responsible for time spent tracking in the google sheet) -->
  <script src="/scripts/time_tracking.js"></script>

  <!-- Phone click tracking: Clicky + API conversion tracking (please do not optimise or modify with AI) -->
  <script>
    // Wait for clicky to load and DOM to be ready
    document.addEventListener('DOMContentLoaded', function() {
      
      function trackPhoneClick(phoneNumber, linkText) {
        // console.log('Phone click detected:', phoneNumber, linkText);
        
        // 1. Track with Clicky
        setTimeout(function() {
          if (typeof clicky !== 'undefined' && clicky.goal) {
            clicky.goal(20930, 0, false);
            // console.log('clicky goal triggered');
          }
        }, 100);
        
        // 2. Track with API
        const isDev = window.location.hostname === 'localhost' || 
                    window.location.hostname === '127.0.0.1';
        const apiUrl = isDev 
          ? '/api/phone-click'
          : 'https://api.local-pest-experts.com/phone-click';
        
        fetch(apiUrl, {
          method: 'POST',
          headers: {
            'Accept': 'application/json',
            'Content-Type': 'application/json'
          }
        })
        .then(response => response.json())
        .then(data => {
          if (data.status === 'success') {
            console.log('API conversion tracked:', data);
          } else if (data.status === 'warning') {
            console.log('API tracking warning:', data.message);
          } else {
            console.log('API tracking failed:', data);
          }
        })
        .catch(error => {
          console.log('API tracking error:', error);
          // Don't block the phone call if API fails
        });
      }

      // Global event listener for all phone link clicks
      document.addEventListener('click', function(e) {
        const target = e.target.closest('a');
        
        if (target) {
          const href = target.getAttribute('href');
          const id = target.getAttribute('id');
          
          // Check if it's a phone link (tel: or id="num")
          if (href && href.startsWith('tel:')) {
            const phoneNumber = href.replace('tel:', '');
            const linkText = target.textContent.trim();
            
            // Track with both systems
            trackPhoneClick(phoneNumber, linkText);
          }
        }
      });

      // console.log('phone button click tracking initialized (Clicky + API)');
    });
  </script> 

<!-- Location Data Prefetch Script (please do not optimise or modify with AI) -->
<script>
  (function() {
    // Defer execution slightly to prioritize rendering
    setTimeout(() => {
      const getLocationIdFromUrl = () => {
        const urlParams = new URLSearchParams(window.location.search);
        return urlParams.get('loc');
      };

      const locationId = getLocationIdFromUrl();

      if (locationId) {
        window.__PREFETCH_LOCATION_ID__ = locationId;

        // Clean up the search string and encode
        const searchParams = window.location.search.substring(1);
        const encodedParams = encodeURIComponent(searchParams);

        const isDev = window.location.hostname === 'localhost' ||
                window.location.hostname === '127.0.0.1';
        const apiUrl = isDev
                ? `/api/geotarget/${locationId}?url_parameters=${encodedParams}`
                : `https://api.local-pest-experts.com/geotarget/${locationId}?url_parameters=${encodedParams}`;

        // Use low priority fetch
        window.__PREFETCH_LOCATION_PROMISE__ = fetch(apiUrl, {
          method: 'GET',
          headers: { 'Accept': 'application/json' },
          importance: 'high'
        }).then(response => response.ok ? response.json() : null)
                .catch(() => null);
      }
    }, 50);
  })();
</script>
<!-- Deferred scripts -->
<script defer type="module" src="/src/main.tsx"></script>
</body>
</html>
